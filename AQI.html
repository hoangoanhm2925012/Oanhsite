<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√≠nh Ch·ªâ S·ªë AQI - US EPA</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        /* Font ch·ªØ ti·∫øng Vi·ªát ƒë·∫πp */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Hi·ªáu ·ª©ng gradient ƒë·ªông cho n·ªÅn */
        .bg-nature {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 50%, #d299c2 100%);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Hi·ªáu ·ª©ng nh·∫•p nh√°y cho k·∫øt qu·∫£ */
        .pulse-result {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        /* Thanh ti·∫øn tr√¨nh AQI */
        .aqi-bar {
            background: linear-gradient(to right, 
                #00e400 0%, #00e400 10%,      /* T·ªët */
                #ffff00 10%, #ffff00 20%,      /* Trung b√¨nh */
                #ff7e00 20%, #ff7e00 30%,      /* K√©m */
                #ff0000 30%, #ff0000 40%,      /* X·∫•u */
                #8f3f97 40%, #8f3f97 60%,      /* R·∫•t x·∫•u */
                #7e0023 60%, #7e0023 100%      /* Nguy h·∫°i */
            );
        }
    </style>
</head>
<body class="bg-nature min-h-screen flex items-center justify-center p-4">
    
    <!-- Container ch√≠nh -->
    <div class="bg-white/90 backdrop-blur-sm rounded-3xl shadow-2xl p-8 max-w-lg w-full">
        
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-green-400 to-emerald-600 rounded-full mb-4 shadow-lg">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"></path>
                </svg>
            </div>
            <h1 class="text-2xl font-bold text-gray-800 mb-2">T√≠nh Ch·ªâ S·ªë Ch·∫•t L∆∞·ª£ng Kh√¥ng Kh√≠</h1>
            <p class="text-gray-600 text-sm">Theo ti√™u chu·∫©n US EPA (Environmental Protection Agency)</p>
        </div>
        
        <!-- Form nh·∫≠p li·ªáu -->
        <div class="mb-6">
            <label for="pm25Input" class="block text-gray-700 font-medium mb-2">
                N·ªìng ƒë·ªô PM2.5 (¬µg/m¬≥):
            </label>
            <div class="relative">
                <input 
                    type="number" 
                    id="pm25Input" 
                    placeholder="Nh·∫≠p gi√° tr·ªã PM2.5..."
                    min="0"
                    max="1000"
                    step="0.1"
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:outline-none transition-colors text-lg"
                >
                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 text-sm">¬µg/m¬≥</span>
            </div>
            <p class="text-xs text-gray-500 mt-2">
                üí° PM2.5 l√† b·ª•i m·ªãn c√≥ ƒë∆∞·ªùng k√≠nh ‚â§ 2.5 micromet
            </p>
        </div>
        
        <!-- N√∫t t√≠nh to√°n -->
        <button 
            id="calculateBtn"
            onclick="calculateAQI()"
            class="w-full bg-gradient-to-r from-emerald-500 to-green-600 text-white font-semibold py-3 px-6 rounded-xl hover:from-emerald-600 hover:to-green-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5"
        >
            üîç T√≠nh Ch·ªâ S·ªë AQI
        </button>
        
        <!-- Khu v·ª±c hi·ªÉn th·ªã k·∫øt qu·∫£ -->
        <div id="resultSection" class="hidden mt-8">
            
            <!-- V√≤ng tr√≤n hi·ªÉn th·ªã AQI -->
            <div class="flex justify-center mb-6">
                <div id="aqiCircle" class="w-32 h-32 rounded-full flex flex-col items-center justify-center shadow-lg pulse-result">
                    <span class="text-4xl font-bold" id="aqiValue">--</span>
                    <span class="text-sm font-medium">AQI</span>
                </div>
            </div>
            
            <!-- Ph√¢n lo·∫°i ch·∫•t l∆∞·ª£ng -->
            <div id="categoryBox" class="text-center p-4 rounded-xl mb-4">
                <p class="text-lg font-semibold" id="categoryText">--</p>
                <p class="text-sm mt-1" id="healthAdvice">--</p>
            </div>
            
            <!-- Thanh AQI tr·ª±c quan -->
            <div class="mb-4">
                <div class="aqi-bar h-4 rounded-full relative overflow-hidden">
                    <div id="aqiMarker" class="absolute w-3 h-6 bg-white border-2 border-gray-800 rounded-full -top-1 transition-all duration-500" style="left: 0%"></div>
                </div>
                <div class="flex justify-between text-xs text-gray-500 mt-1">
                    <span>0</span>
                    <span>50</span>
                    <span>100</span>
                    <span>150</span>
                    <span>200</span>
                    <span>300</span>
                    <span>500</span>
                </div>
            </div>
            
            <!-- Th√¥ng tin chi ti·∫øt -->
            <div class="bg-gray-50 rounded-xl p-4 text-sm">
                <h3 class="font-semibold text-gray-700 mb-2">üìä Chi ti·∫øt t√≠nh to√°n:</h3>
                <p class="text-gray-600" id="calculationDetail">--</p>
            </div>
        </div>
        
        <!-- B·∫£ng tham kh·∫£o ph√¢n lo·∫°i AQI -->
        <div class="mt-8 pt-6 border-t border-gray-200">
            <h3 class="font-semibold text-gray-700 mb-3 text-center">üìã B·∫£ng Ph√¢n Lo·∫°i AQI (US EPA)</h3>
            <div class="grid grid-cols-1 gap-2 text-sm">
                <div class="flex items-center gap-3 p-2 rounded-lg bg-green-100">
                    <div class="w-4 h-4 rounded-full bg-[#00e400]"></div>
                    <span class="font-medium">0-50:</span>
                    <span>T·ªët - Ch·∫•t l∆∞·ª£ng kh√¥ng kh√≠ ƒë·∫°t y√™u c·∫ßu</span>
                </div>
                <div class="flex items-center gap-3 p-2 rounded-lg bg-yellow-100">
                    <div class="w-4 h-4 rounded-full bg-[#ffff00]"></div>
                    <span class="font-medium">51-100:</span>
                    <span>Trung b√¨nh - Ch·∫•p nh·∫≠n ƒë∆∞·ª£c</span>
                </div>
                <div class="flex items-center gap-3 p-2 rounded-lg bg-orange-100">
                    <div class="w-4 h-4 rounded-full bg-[#ff7e00]"></div>
                    <span class="font-medium">101-150:</span>
                    <span>K√©m - Nh√≥m nh·∫°y c·∫£m c·∫ßn ch√∫ √Ω</span>
                </div>
                <div class="flex items-center gap-3 p-2 rounded-lg bg-red-100">
                    <div class="w-4 h-4 rounded-full bg-[#ff0000]"></div>
                    <span class="font-medium">151-200:</span>
                    <span>X·∫•u - ·∫¢nh h∆∞·ªüng ƒë·∫øn m·ªçi ng∆∞·ªùi</span>
                </div>
                <div class="flex items-center gap-3 p-2 rounded-lg bg-purple-100">
                    <div class="w-4 h-4 rounded-full bg-[#8f3f97]"></div>
                    <span class="font-medium">201-300:</span>
                    <span>R·∫•t x·∫•u - C·∫£nh b√°o s·ª©c kh·ªèe</span>
                </div>
                <div class="flex items-center gap-3 p-2 rounded-lg bg-rose-100">
                    <div class="w-4 h-4 rounded-full bg-[#7e0023]"></div>
                    <span class="font-medium">301-500:</span>
                    <span>Nguy h·∫°i - Kh·∫©n c·∫•p s·ª©c kh·ªèe</span>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="mt-6 text-center text-xs text-gray-500">
            <p>üåø D·ªØ li·ªáu d·ª±a tr√™n ti√™u chu·∫©n US EPA cho PM2.5 (24 gi·ªù)</p>
        </div>
    </div>

    <script>
        /**
         * =====================================================
         * C√îNG C·ª§ T√çNH CH·ªà S·ªê CH·∫§T L∆Ø·ª¢NG KH√îNG KH√ç (AQI)
         * Theo ti√™u chu·∫©n US EPA (Environmental Protection Agency)
         * =====================================================
         */

        /**
         * B·∫£ng Breakpoint AQI cho PM2.5 theo US EPA
         * M·ªói m·ª•c ch·ª©a: [BP_Lo, BP_Hi, I_Lo, I_Hi]
         * BP = Breakpoint n·ªìng ƒë·ªô PM2.5 (¬µg/m¬≥)
         * I = Index AQI t∆∞∆°ng ·ª©ng
         */
        const PM25_BREAKPOINTS = [
            { bpLo: 0.0,   bpHi: 12.0,   iLo: 0,   iHi: 50,  category: "T·ªët" },
            { bpLo: 12.1,  bpHi: 35.4,   iLo: 51,  iHi: 100, category: "Trung b√¨nh" },
            { bpLo: 35.5,  bpHi: 55.4,   iLo: 101, iHi: 150, category: "K√©m" },
            { bpLo: 55.5,  bpHi: 150.4,  iLo: 151, iHi: 200, category: "X·∫•u" },
            { bpLo: 150.5, bpHi: 250.4,  iLo: 201, iHi: 300, category: "R·∫•t x·∫•u" },
            { bpLo: 250.5, bpHi: 350.4,  iLo: 301, iHi: 400, category: "Nguy h·∫°i" },
            { bpLo: 350.5, bpHi: 500.4,  iLo: 401, iHi: 500, category: "Nguy h·∫°i" }
        ];

        /**
         * Th√¥ng tin s·ª©c kh·ªèe t∆∞∆°ng ·ª©ng v·ªõi t·ª´ng m·ª©c AQI
         */
        const HEALTH_ADVICE = {
            "T·ªët": "Ch·∫•t l∆∞·ª£ng kh√¥ng kh√≠ t·ªët. Ho·∫°t ƒë·ªông ngo√†i tr·ªùi b√¨nh th∆∞·ªùng.",
            "Trung b√¨nh": "Nh√≥m nh·∫°y c·∫£m n√™n h·∫°n ch·∫ø ho·∫°t ƒë·ªông ngo√†i tr·ªùi k√©o d√†i.",
            "K√©m": "Tr·∫ª em, ng∆∞·ªùi gi√†, ng∆∞·ªùi b·ªánh h√¥ h·∫•p n√™n h·∫°n ch·∫ø ra ngo√†i.",
            "X·∫•u": "M·ªçi ng∆∞·ªùi n√™n h·∫°n ch·∫ø ho·∫°t ƒë·ªông ngo√†i tr·ªùi. ƒêeo kh·∫©u trang khi ra ngo√†i.",
            "R·∫•t x·∫•u": "Tr√°nh c√°c ho·∫°t ƒë·ªông ngo√†i tr·ªùi. ƒê√≥ng c·ª≠a s·ªï, s·ª≠ d·ª•ng m√°y l·ªçc kh√¥ng kh√≠.",
            "Nguy h·∫°i": "KH·∫®N C·∫§P! ·ªû trong nh√†, tr√°nh m·ªçi ho·∫°t ƒë·ªông ngo√†i tr·ªùi."
        };

        /**
         * M√†u s·∫Øc t∆∞∆°ng ·ª©ng v·ªõi t·ª´ng m·ª©c AQI
         */
        const AQI_COLORS = {
            "T·ªët": { bg: "bg-green-500", text: "text-white", boxBg: "bg-green-100", boxText: "text-green-800" },
            "Trung b√¨nh": { bg: "bg-yellow-400", text: "text-gray-800", boxBg: "bg-yellow-100", boxText: "text-yellow-800" },
            "K√©m": { bg: "bg-orange-500", text: "text-white", boxBg: "bg-orange-100", boxText: "text-orange-800" },
            "X·∫•u": { bg: "bg-red-500", text: "text-white", boxBg: "bg-red-100", boxText: "text-red-800" },
            "R·∫•t x·∫•u": { bg: "bg-purple-600", text: "text-white", boxBg: "bg-purple-100", boxText: "text-purple-800" },
            "Nguy h·∫°i": { bg: "bg-rose-900", text: "text-white", boxBg: "bg-rose-100", boxText: "text-rose-800" }
        };

        /**
         * H√†m t√≠nh ch·ªâ s·ªë AQI t·ª´ n·ªìng ƒë·ªô PM2.5
         * S·ª≠ d·ª•ng c√¥ng th·ª©c US EPA:
         * AQI = ((I_Hi - I_Lo) / (BP_Hi - BP_Lo)) * (C_p - BP_Lo) + I_Lo
         * 
         * @param {number} concentration - N·ªìng ƒë·ªô PM2.5 (¬µg/m¬≥)
         * @returns {object} - K·∫øt qu·∫£ g·ªìm AQI, category v√† th√¥ng tin breakpoint
         */
        function computeAQI(concentration) {
            // L√†m tr√≤n n·ªìng ƒë·ªô ƒë·∫øn 1 ch·ªØ s·ªë th·∫≠p ph√¢n (theo quy ƒë·ªãnh US EPA)
            const Cp = Math.round(concentration * 10) / 10;
            
            // Ki·ªÉm tra gi·ªõi h·∫°n
            if (Cp < 0) {
                return { error: "N·ªìng ƒë·ªô kh√¥ng th·ªÉ √¢m!" };
            }
            
            if (Cp > 500.4) {
                return { 
                    aqi: 500, 
                    category: "Nguy h·∫°i", 
                    note: "V∆∞·ª£t qu√° thang ƒëo (>500.4 ¬µg/m¬≥)",
                    breakpoint: PM25_BREAKPOINTS[6]
                };
            }
            
            // T√¨m breakpoint ph√π h·ª£p
            for (let bp of PM25_BREAKPOINTS) {
                if (Cp >= bp.bpLo && Cp <= bp.bpHi) {
                    // √Åp d·ª•ng c√¥ng th·ª©c AQI
                    const aqi = ((bp.iHi - bp.iLo) / (bp.bpHi - bp.bpLo)) * (Cp - bp.bpLo) + bp.iLo;
                    
                    return {
                        aqi: Math.round(aqi),  // L√†m tr√≤n ƒë·∫øn s·ªë nguy√™n
                        category: bp.category,
                        breakpoint: bp,
                        truncatedConcentration: Cp
                    };
                }
            }
            
            return { error: "Kh√¥ng t√¨m ƒë∆∞·ª£c breakpoint ph√π h·ª£p!" };
        }

        /**
         * H√†m ch√≠nh x·ª≠ l√Ω t√≠nh to√°n v√† hi·ªÉn th·ªã k·∫øt qu·∫£
         */
        function calculateAQI() {
            // L·∫•y gi√° tr·ªã t·ª´ input
            const inputElement = document.getElementById('pm25Input');
            const inputValue = parseFloat(inputElement.value);
            
            // Ki·ªÉm tra ƒë·∫ßu v√†o h·ª£p l·ªá
            if (isNaN(inputValue) || inputValue === '') {
                alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p gi√° tr·ªã PM2.5 h·ª£p l·ªá!');
                inputElement.focus();
                return;
            }
            
            if (inputValue < 0) {
                alert('‚ö†Ô∏è N·ªìng ƒë·ªô PM2.5 kh√¥ng th·ªÉ l√† s·ªë √¢m!');
                inputElement.focus();
                return;
            }
            
            // T√≠nh to√°n AQI
            const result = computeAQI(inputValue);
            
            // Ki·ªÉm tra l·ªói
            if (result.error) {
                alert('‚ùå ' + result.error);
                return;
            }
            
            // Hi·ªÉn th·ªã k·∫øt qu·∫£
            displayResult(result, inputValue);
        }

        /**
         * H√†m hi·ªÉn th·ªã k·∫øt qu·∫£ l√™n giao di·ªán
         * @param {object} result - K·∫øt qu·∫£ t√≠nh to√°n AQI
         * @param {number} originalValue - Gi√° tr·ªã PM2.5 g·ªëc ng∆∞·ªùi d√πng nh·∫≠p
         */
        function displayResult(result, originalValue) {
            // Hi·ªán khu v·ª±c k·∫øt qu·∫£
            const resultSection = document.getElementById('resultSection');
            resultSection.classList.remove('hidden');
            
            // C·∫≠p nh·∫≠t gi√° tr·ªã AQI
            const aqiValueElement = document.getElementById('aqiValue');
            aqiValueElement.textContent = result.aqi;
            
            // L·∫•y m√†u s·∫Øc t∆∞∆°ng ·ª©ng
            const colors = AQI_COLORS[result.category];
            
            // C·∫≠p nh·∫≠t v√≤ng tr√≤n AQI
            const aqiCircle = document.getElementById('aqiCircle');
            aqiCircle.className = `w-32 h-32 rounded-full flex flex-col items-center justify-center shadow-lg pulse-result ${colors.bg} ${colors.text}`;
            
            // C·∫≠p nh·∫≠t ph√¢n lo·∫°i
            const categoryBox = document.getElementById('categoryBox');
            categoryBox.className = `text-center p-4 rounded-xl mb-4 ${colors.boxBg}`;
            
            const categoryText = document.getElementById('categoryText');
            categoryText.textContent = `üè∑Ô∏è Ph√¢n lo·∫°i: ${result.category}`;
            categoryText.className = `text-lg font-semibold ${colors.boxText}`;
            
            // C·∫≠p nh·∫≠t l·ªùi khuy√™n s·ª©c kh·ªèe
            const healthAdvice = document.getElementById('healthAdvice');
            healthAdvice.textContent = HEALTH_ADVICE[result.category];
            healthAdvice.className = `text-sm mt-1 ${colors.boxText}`;
            
            // C·∫≠p nh·∫≠t v·ªã tr√≠ marker tr√™n thanh AQI
            const marker = document.getElementById('aqiMarker');
            const markerPosition = Math.min((result.aqi / 500) * 100, 100);
            marker.style.left = `calc(${markerPosition}% - 6px)`;
            
            // C·∫≠p nh·∫≠t chi ti·∫øt t√≠nh to√°n
            const bp = result.breakpoint;
            const detail = document.getElementById('calculationDetail');
            detail.innerHTML = `
                <strong>C√¥ng th·ª©c US EPA:</strong><br>
                AQI = ((I<sub>Hi</sub> - I<sub>Lo</sub>) / (BP<sub>Hi</sub> - BP<sub>Lo</sub>)) √ó (C<sub>p</sub> - BP<sub>Lo</sub>) + I<sub>Lo</sub><br><br>
                <strong>√Åp d·ª•ng:</strong><br>
                ‚Ä¢ N·ªìng ƒë·ªô PM2.5 nh·∫≠p: ${originalValue} ¬µg/m¬≥<br>
                ‚Ä¢ N·ªìng ƒë·ªô l√†m tr√≤n (C<sub>p</sub>): ${result.truncatedConcentration || originalValue} ¬µg/m¬≥<br>
                ‚Ä¢ Breakpoint: ${bp.bpLo} - ${bp.bpHi} ¬µg/m¬≥<br>
                ‚Ä¢ Index t∆∞∆°ng ·ª©ng: ${bp.iLo} - ${bp.iHi}<br>
                ‚Ä¢ <strong>K·∫øt qu·∫£ AQI = ${result.aqi}</strong>
                ${result.note ? `<br>‚Ä¢ ‚ö†Ô∏è ${result.note}` : ''}
            `;
            
            // Cu·ªôn ƒë·∫øn k·∫øt qu·∫£
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Cho ph√©p nh·∫•n Enter ƒë·ªÉ t√≠nh to√°n
        document.getElementById('pm25Input').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                calculateAQI();
            }
        });

        // Focus v√†o √¥ input khi trang load
        window.onload = function() {
            document.getElementById('pm25Input').focus();
        };
    </script>
</body>
</html>
